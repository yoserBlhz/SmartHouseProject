<div class="dashboard-layout" [class.sidebar-closed]="isSidebarClosed">
  <app-navbar></app-navbar>
  <div class="main-container">
    <app-sidebar class="app-sidebar" (sidebarToggled)="handleSidebarToggle($event)"></app-sidebar>
    <div class="main-content">
      <div class="dynamic-bg">
        <div class="dashboard">
          <div class="card temperature-card">
            <div class="temp-value">
              <img src="/assets/other/cloud.png" alt="Cloud" class="temp-image" />
              <span class="temperature-text">{{ humidity }}%HR</span>
            </div>
            <div class="temp-title">
              <span>Humidity</span>
            </div>
          </div>
      
          <div class="card temperature-card">
            <div class="temp-value">
              <img src="/assets/other/sun1.png" alt="Sun" class="temp-image" />
              <span class="temperature-text">{{ temperature }}Â°C</span>
            </div>
            <div class="temp-title">
              <span>Temperature</span>
            </div>
            <div class="temp-controls">
              <img
                src="/assets/other/add.png"
                alt="Increase"
                class="icon plus"
                (click)="adjustTemperature(1)"
              />
              <img
                src="/assets/other/minus-circle.png"
                alt="Decrease"
                class="icon minus"
                (click)="adjustTemperature(-1)"
              />
            </div>
          </div>
      
          <div class="card temperature-card">
            <div class="temp-value">
              <img src="/assets/other/heat.png" alt="Heat" class="temp-image" />
              <span class="temperature-text">{{ gasLevel }} ppm</span>
            </div>
            <div class="temp-title">
              <span>Gas</span>
            </div>
          </div>
        </div>
      
        <div class="devices-section">
          <h2 class="devices-title">Room: {{roomName}}
            <button class="delete-room" (click)="confirmDelete(roomName)" data-bs-toggle="modal" data-bs-target="#deleteRoomModal">Delete This Room</button>
          </h2>
          <mat-form-field appearance="outline" class="search-bar">
            <mat-label>Search devices</mat-label>
            <input
              matInput
              placeholder="Search devices..."
              [(ngModel)]="searchQuery"
              (input)="applyFilter($event)"
            />
          </mat-form-field>

          <button mat-raised-button color="primary" (click)="openAddDeviceDialog()" class="add-device-button">
            Add Device
          </button>
      
          <table mat-table [dataSource]="dataSource" matSort>
            <ng-container matColumnDef="name">
              <th mat-header-cell *matHeaderCellDef mat-sort-header>Device</th>
              <td mat-cell *matCellDef="let device">{{ device.name }}</td>
            </ng-container>
          
            <ng-container matColumnDef="isOn">
              <th mat-header-cell *matHeaderCellDef mat-sort-header>State</th>
              <td mat-cell *matCellDef="let device">
                <button
                  class="toggle-button"
                  [class.on]="device.isOn"
                  [class.off]="!device.isOn"
                  (click)="toggleDevice(device)"
                >
                  {{ device.isOn ? "ON" : "OFF" }}
                </button>
              </td>
            </ng-container>
          
            <ng-container matColumnDef="actions">
              <th mat-header-cell *matHeaderCellDef>Actions</th>
              <td mat-cell *matCellDef="let device">
                <button
                  class="delete-button"
                  (click)="deleteDevice(device)"
                >
                  Delete
                </button>
              </td>
            </ng-container>
          
            <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
            <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>
          </table>
      
          <mat-paginator
            [length]="dataSource.data.length"
            [pageSize]="5"
            [pageSizeOptions]="[5, 10, 25]"
            showFirstLastButtons
          ></mat-paginator>
        </div>
      </div>
    </div>
  </div>
</div>

<style>
  .add-device-button {
    margin-left: 16px;
    margin-bottom: 16px;
  }
</style>



<div class="modal fade" #deleteRoomModal tabindex="-1" role="dialog" id="deleteRoomModal">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title"><i class="bi bi-exclamation-triangle"></i>Confirm Delete</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <p>Are you sure you want to delete this room?</p>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-custom" (click)="deleteRoom()">Delete</button>
        <button type="button" class="btn btn-custom2" data-bs-dismiss="modal">Cancel</button>
      </div>
    </div>
  </div>
</div>